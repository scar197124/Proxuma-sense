<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Proxuma Sense</title>
<style>
:root{
  --neon:#00ff66;
}

/* ===== DARK (NEON) THEME ===== */
body.dark{
  --bg:#0b0f0d;
  --panel:#111815;
  --text:#e8f5ee;
  --muted:#9fb8aa;
  --accent:var(--neon);
}

/* ===== LIGHT (WHITE) THEME ===== */
body.light{
  --bg:#ffffff;
  --panel:#f5f5f5;
  --text:#0b0f0d;
  --muted:#444;
  --accent:#000000;
}

body{
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  background:var(--bg);
  color:var(--text);
  display:flex;
  align-items:center;
  justify-content:center;
  min-height:100vh;
  margin:0;
  padding:20px;
  box-sizing:border-box;
}

.container{
  background:var(--panel);
  border:1px solid var(--accent);
  border-radius:14px;
  max-width:720px;
  width:100%;
  padding:44px 46px 40px;
}

/* Header */
.title{
  font-size:44px;
  font-weight:700;
  text-align:center;
  letter-spacing:0.6px;
  color:var(--accent);
}
.subtitle{
  font-size:22px;
  text-align:center;
  margin-top:6px;
  letter-spacing:1.5px;
}

/* Theme toggle block */
.themeRow{
  margin-top:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  font-size:13px;
  color:var(--muted);
}

.toggle{
  position:relative;
  width:44px;
  height:22px;
}
.toggle input{
  opacity:0;
  width:0;
  height:0;
}
.slider{
  position:absolute;
  cursor:pointer;
  top:0; left:0; right:0; bottom:0;
  background:transparent;
  border:1px solid var(--accent);
  border-radius:999px;
  transition:.2s;
}
.slider:before{
  position:absolute;
  content:"";
  height:16px;
  width:16px;
  left:3px;
  bottom:2px;
  background:var(--accent);
  border-radius:50%;
  transition:.2s;
}
input:checked + .slider:before{
  transform:translateX(20px);
}

.divider{
  margin:22px 0;
  height:1px;
  background:var(--accent);
}

/* Form */
label{font-size:14px;color:var(--muted)}
input[type=text]{
  width:100%;
  padding:13px 14px;
  margin-top:6px;
  font-size:16px;
  border-radius:10px;
  border:1px solid var(--accent);
  background:transparent;
  color:var(--text);
  box-sizing:border-box;
}
button{
  margin-top:14px;
  width:100%;
  padding:13px;
  font-size:16px;
  border-radius:12px;
  border:1px solid var(--accent);
  background:transparent;
  color:var(--text);
  cursor:pointer;
}
button:hover{opacity:0.85}

/* Result */
.result{
  display:none;
  margin-top:18px;
  padding:18px;
  border-radius:12px;
  border:1px solid var(--accent);
  line-height:1.55;
}
.pill{
  display:inline-block;
  padding:4px 12px;
  border-radius:999px;
  font-size:12px;
  margin-bottom:8px;
  border:1px solid var(--accent);
}
ul{margin:6px 0 0 18px}
li{margin:6px 0}
.mono{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:13px}
.status{
  margin-top:18px;
  font-size:12px;
  color:var(--muted);
  text-align:center;
  letter-spacing:0.6px;
}
</style>
</head>

<body class="dark">
<div class="container">
  <div class="title">Proxuma</div>
  <div class="subtitle">Sense</div>

  <div class="themeRow">
    <span>Dark</span>
    <label class="toggle">
      <input type="checkbox" id="themeToggle" aria-label="Toggle theme">
      <span class="slider"></span>
    </label>
    <span>Light</span>
  </div>

  <div class="divider"></div>

  <label>Paste a link to examine</label>
  <input id="link" type="text" placeholder="https://example.com" autocomplete="off" spellcheck="false">
  <button id="checkBtn">Check link</button>

  <div id="result" class="result"></div>

  <div class="status">Presentation Mode · Sense (Light + Shield)</div>
</div>

<script>
function escapeHTML(s){return s.replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]))}
function parseInput(raw){
  const txt = raw.trim();
  if(!txt) return {ok:false,msg:"Please paste a link first."};
  let candidate = txt;
  if(!/^https?:\/\//i.test(candidate)) candidate = "https://" + candidate;
  try{ const u = new URL(candidate); return {ok:true,input:txt,url:u}; }
  catch{ return {ok:false,msg:"That doesn’t look like a valid URL format."}; }
}

/* ===== Heuristics (logic fix only) ===== */

const BRANDS=["paypal","apple","bank"];
const LOGIN_WORDS=["login","log-in","signin","sign-in","verify","verification","account","secure"];

function getRegistrableDomain(host){
  // Simple, offline-safe heuristic: last two labels (works for most .com/.net/.org).
  // If host is like "a.b.c", registrable is "b.c". For "localhost" returns host.
  const parts = host.split(".").filter(Boolean);
  if(parts.length <= 2) return host;
  return parts.slice(-2).join(".");
}

function detectSignals(parsed){
  const u = parsed.url;
  const host = u.hostname.toLowerCase();
  const full = (u.hostname + u.pathname + u.search).toLowerCase();
  const signals = [];

  // Basic structural flags preserved from original build
  if(/^\d{1,3}(?:\.\d{1,3}){3}$/.test(host))
    signals.push("Link uses an IP address instead of a domain name.");
  if(/,/.test(parsed.input))
    signals.push("The link contains a comma. Commas are not valid in domain names.");
  if(!/\.[a-z]{2,}$/i.test(host))
    signals.push("The domain does not end with a standard top-level domain.");
  if(host.includes("0"))
    signals.push("The hostname contains the number '0', which can mimic the letter 'o'.");

  // NEW: login/verification language (URL-structure only, no page loading)
  if(LOGIN_WORDS.some(w => full.includes(w)))
    signals.push("Login / verification language present.");

  // NEW: brand keywords present
  const brandHit = BRANDS.find(b => full.includes(b));
  if(brandHit)
    signals.push("Brand-related keywords present.");

  // NEW: brand terms appear outside the registrable domain
  const reg = getRegistrableDomain(host);
  const sub = host === reg ? "" : host.slice(0, Math.max(0, host.length - reg.length - 1)); // remove ".reg"
  const subHasBrand = BRANDS.some(b => sub.includes(b));
  if(sub && subHasBrand)
    signals.push("Brand terms appear outside the registrable domain.");

  return {host, signals};
}

function render(parsed,det){
  const box=document.getElementById("result");
  box.style.display="block";

  let html='<div class="pill">Sense</div>';
  html+='<div class="mono">'+escapeHTML(parsed.input)+'</div>';
  html+='<div class="mono" style="margin-top:6px">hostname: '+escapeHTML(det.host)+'</div>';

  if(det.signals.length){
    html+='<div style="margin-top:10px"><strong>Observable signals detected from the URL structure:</strong><ul>';
    det.signals.forEach(s=>html+='<li>'+escapeHTML(s)+'</li>');
    html+='</ul></div>';
  }else{
    html+='<div style="margin-top:10px"><strong>Observable signals:</strong> none detected from the URL structure.</div>';
  }

  html+='<div class="pill" style="margin-top:14px">Shield</div>';
  html+='<div>No immediate action required. However, links requesting login or verification on non-official domains should be reviewed carefully.</div>';

  box.innerHTML=html;
}

document.getElementById("checkBtn").onclick=()=>{
  const raw=document.getElementById("link").value;
  const parsed=parseInput(raw);
  const box=document.getElementById("result");
  if(!parsed.ok){
    box.style.display="block";
    box.innerHTML='<div class="pill">Shield</div>'+escapeHTML(parsed.msg);
    return;
  }
  render(parsed,detectSignals(parsed));
};

document.getElementById("link").addEventListener("keydown",e=>{
  if(e.key==="Enter") document.getElementById("checkBtn").click();
});

// Theme toggle: ensure exactly one theme class is active at all times (prevents "blank" look)
document.getElementById("themeToggle").addEventListener("change",(e)=>{
  if(e.target.checked){
    document.body.classList.remove("dark");
    document.body.classList.add("light");
  }else{
    document.body.classList.remove("light");
    document.body.classList.add("dark");
  }
});
</script>
</body>
</html>
